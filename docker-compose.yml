services:
  # 1. Database (The core Neo4j instance)
  neo4j:
    image: neo4j:5
    container_name: neo4j
    ports:
      - "7474:7474"   # Browser Interface
      - "7687:7687"   # Bolt Protocol (for Python)
    environment:
      # --- OLD PASSWORD KEPT HERE ---
      NEO4J_AUTH: "neo4j/Qwertz123!"
      # ------------------------------
      NEO4J_PLUGINS: '["apoc"]'
      NEO4J_dbms_security_procedures_unrestricted: "apoc.*"
      NEO4J_dbms_security_procedures_allowlist: "apoc.*"
      NEO4J_apoc_import_file_enabled: "true"
      NEO4J_apoc_export_file_enabled: "true"
      # Allow loading CSVs from the mounted import folder
      #NEO4J_server_security_allow__csv__import__from__file__urls: "true"
    volumes:
      - ./data:/data
      - ./etl:/etl
      # This maps your local 'import' folder to where Neo4j expects files
      - ./import:/var/lib/neo4j/import
      - neo4j_data:/var/lib/neo4j
      - ./scripts:/scripts

  # 2. Backend API (Your Python Code)
  backend:
    build: ./backend
    container_name: backend
    ports:
      - "8000:8000"
    environment:
      # Connect to the 'neo4j' container name
      - NEO4J_URI=bolt://neo4j:7687
      # Pass the password to Python automatically
      - NEO4J_PASSWORD=Qwertz123!
    depends_on:
      - neo4j

  # 3. Frontend (Your Web Interface)
  frontend:
    build: ./frontend
    container_name: frontend
    ports:
      - "3000:80" # Accessible at http://localhost:3000
    depends_on:
      - backend

# Persistent storage for the database
volumes:
  neo4j_data: